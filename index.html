<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wise Productions — Critical Client Flow</title>
  <style>
    body {
      margin: 0;
      background: #fdfdfc; /* Paper white */
      color: #333;
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
    }
    header {
      background: #fdfdfc;
      padding: .8rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      border-bottom: 1px solid #ddd;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .title {
      font-weight: 700;
      font-size: 1.4rem;
      color: #192a56;
    }
    .btn {
      appearance: none;
      border: none;
      background: #192a56;
      color: #fff;
      padding: .55rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      display: none;
    }
    .canvas {
      position: relative;
      height: 90vh;
      overflow-y: auto; /* add scrollbar for milestone page */
    }
    svg {
      width: 100%;
      display: block;
    }
    .node rect {
      stroke: none;
      stroke-width: 2;
      rx: 28;
      ry: 28;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,.15));
    }
    .label {
      font-size: 36px;
      fill: #fff;
      font-weight: 700;
      pointer-events: none;
      text-anchor: middle;
      dominant-baseline: hanging;
    }
    .subtext {
      font-size: 20px;
      fill: #f1f5f9;
      font-weight: 400;
      pointer-events: none;
      text-anchor: middle;
      dominant-baseline: hanging;
    }
    .edge {
      stroke: #555;
      stroke-width: 2.5;
      fill: none;
      marker-end: url(#arrow);
    }
    .dimmed rect {
      filter: grayscale(100%) brightness(0.7);
    }
    .dimmed text {
      fill: #aaa !important;
    }
  </style>
</head>
<body>
  <header>
    <div class="title">Wise Productions — Critical Client Flow</div>
    <button class="btn" id="back">← Back</button>
  </header>

  <div class="canvas" id="canvas">
    <svg id="svg" viewBox="0 0 2000 4000" preserveAspectRatio="xMidYMin">
      <defs>
        <!-- Elegant slim arrow -->
        <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#555"></path>
        </marker>

        <!-- Gradients navy → rose -->
        <linearGradient id="grad0" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#192a56"/>
          <stop offset="100%" stop-color="#2e3c6a"/>
        </linearGradient>
        <linearGradient id="grad1" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#2e3c6a"/>
          <stop offset="100%" stop-color="#4c4d77"/>
        </linearGradient>
        <linearGradient id="grad2" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#4c4d77"/>
          <stop offset="100%" stop-color="#6b5c7e"/>
        </linearGradient>
        <linearGradient id="grad3" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#6b5c7e"/>
          <stop offset="100%" stop-color="#876683"/>
        </linearGradient>
        <linearGradient id="grad4" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#876683"/>
          <stop offset="100%" stop-color="#9e768f"/>
        </linearGradient>
      </defs>
      <g id="edges"></g>
      <g id="nodes"></g>
    </svg>
  </div>

  <script>
    const milestones = [
      { id:'enquiry', title:'Enquiry received & logged', substeps:[
        'Capture via web, email or phone',
        'Log in CRM/Opsync',
        'Auto-acknowledge receipt'
      ]},
      { id:'qualify', title:'Qualification', substeps:[
        'Clarify scope, budget, dates, venue',
        'Tiering (T1/T2/T3)',
        'Assign provisional owner'
      ]},
      { id:'proposal', title:'Proposal / Quote sent', substeps:[
        'Estimate crew, kit, logistics',
        'Price build + GP check',
        'Proposal issued with expiry'
      ]},
      { id:'approval', title:'Approval & Deposit', substeps:[
        'Contract + T&Cs issued',
        'PO or e-signature captured',
        'Deposit/payment confirmed'
      ]},
      { id:'planning', title:'Pre-production & Planning', substeps:[
        'Assign PM & create plan',
        'Design sign-off & HOD review',
        'Crew, logistics, kit prep scheduled'
      ]},
      { id:'delivery', title:'Event Delivery', substeps:[
        'Warehouse prep & QA checks',
        'Load-in → show → load-out',
        'On-site sign-offs captured'
      ]},
      { id:'wrap', title:'Post-event wrap → END', substeps:[
        'Crew & client feedback captured',
        'Final invoice issued and paid',
        'Retrospective stored'
      ]}
    ];

    const svg=document.getElementById('svg');
    const gNodes=document.getElementById('nodes');
    const gEdges=document.getElementById('edges');
    const backBtn=document.getElementById('back');

    function clear(){gNodes.innerHTML='';gEdges.innerHTML='';}

    function drawFlow(items){
      clear();
      const NODE_W=800, SPACING=200;
      const centerX = 1000 - NODE_W/2;
      let y = 200;
      items.forEach((s,i)=>{
        const lineCount=s.substeps.length+1;
        const NODE_H=140+(lineCount*40);

        const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('data-id',s.id);
        g.setAttribute('class','node');

        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x',centerX);
        rect.setAttribute('y',y);
        rect.setAttribute('width',NODE_W);
        rect.setAttribute('height',NODE_H);
        rect.setAttribute('fill',`url(#grad${Math.min(i,4)})`);

        const label=document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x',centerX+NODE_W/2);
        label.setAttribute('y',y+50);
        label.setAttribute('class','label');
        label.textContent=s.title;

        g.appendChild(rect);
        g.appendChild(label);

        s.substeps.forEach((st,idx)=>{
          const sub=document.createElementNS('http://www.w3.org/2000/svg','text');
          sub.setAttribute('x',centerX+NODE_W/2);
          sub.setAttribute('y',y+110+(idx*36));
          sub.setAttribute('class','subtext');
          sub.textContent='• '+st;
          g.appendChild(sub);
        });

        gNodes.appendChild(g);

        if(i<items.length-1){
          const path=document.createElementNS('http://www.w3.org/2000/svg','path');
          path.setAttribute('d',`M ${centerX+NODE_W/2} ${y+NODE_H} L ${centerX+NODE_W/2} ${y+NODE_H+SPACING}`);
          path.setAttribute('class','edge');
          gEdges.appendChild(path);
        }

        y += NODE_H + SPACING;
      });
    }

    let currentLevel='overview';
    function showOverview(){
      currentLevel='overview';
      backBtn.style.display='none';
      drawFlow(milestones);
      resetView();
    }

    function showSubsteps(id){
      const m=milestones.find(x=>x.id===id);
      if(!m) return;
      currentLevel=id;
      backBtn.style.display='inline-block';
      clear();
      const NODE_W=800,NODE_H=220,SPACING=150;
      const centerX=1000-NODE_W/2;
      let y=200;
      m.substeps.forEach((s,i)=>{
        const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('data-id',s);
        g.setAttribute('class','node');

        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x',centerX);
        rect.setAttribute('y',y);
        rect.setAttribute('width',NODE_W);
        rect.setAttribute('height',NODE_H);
        rect.setAttribute('fill',`url(#grad${Math.min(i,4)})`);

        const label=document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x',centerX+NODE_W/2);
        label.setAttribute('y',y+NODE_H/2);
        label.setAttribute('class','label');
        label.textContent=s;

        g.appendChild(rect);
        g.appendChild(label);
        gNodes.appendChild(g);

        if(i<m.substeps.length-1){
          const path=document.createElementNS('http://www.w3.org/2000/svg','path');
          path.setAttribute('d',`M ${centerX+NODE_W/2} ${y+NODE_H} L ${centerX+NODE_W/2} ${y+NODE_H+SPACING}`);
          path.setAttribute('class','edge');
          gEdges.appendChild(path);
        }
        y+=NODE_H+SPACING;
      });
      resetView();
    }

    // Hover highlight
    gNodes.addEventListener('mouseover',e=>{
      const g=e.target.closest('g[data-id]');
      if(!g) return;
      gNodes.querySelectorAll('g').forEach(node=>{
        if(node===g){node.classList.remove('dimmed');}
        else{node.classList.add('dimmed');}
      });
    });
    gNodes.addEventListener('mouseout',()=>{gNodes.querySelectorAll('g').forEach(node=>node.classList.remove('dimmed'));});
    gNodes.addEventListener('click',e=>{
      const g=e.target.closest('g[data-id]');
      if(!g) return;
      const id=g.getAttribute('data-id');
      if(currentLevel==='overview') showSubsteps(id);
    });
    backBtn.addEventListener('click',showOverview);

    let view={x:0,y:0,w:2000,h:4000};
    function applyView(){svg.setAttribute('viewBox',`${view.x} ${view.y} ${view.w} ${view.h}`)}
    function resetView(){view={x:0,y:0,w:2000,h:4000};applyView();}
    applyView();

    showOverview();
  </script>
</body>
</html>
