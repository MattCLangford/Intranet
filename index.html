<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wise Productions — Critical Client Flow</title>
  <style>
    body{margin:0;background:#0b0f14;color:#fff;font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans';}
    header{background:#111827;padding:.8rem 1rem;display:flex;align-items:center;gap:1rem;}
    .title{font-weight:700;font-size:1.4rem}
    .btn{appearance:none;border:none;background:#2563eb;color:#fff;padding:.55rem 1rem;border-radius:6px;cursor:pointer;display:none;}
    .canvas{position:relative;height:85vh;}
    svg{width:100%;height:100%;display:block;}
    .node{stroke:#0f172a;stroke-width:3;rx:32;ry:32;cursor:pointer;filter:drop-shadow(0 8px 14px rgba(0,0,0,.6));}
    .label{font-size:48px;fill:#ffffff;font-weight:800;pointer-events:none;text-anchor:middle;dominant-baseline:middle;}
    .label tspan{display:block;}
    .edge{stroke:#94a3b8;stroke-width:6;fill:none;marker-end:url(#arrow)}
  </style>
</head>
<body>
  <header>
    <div class="title">Wise Productions — Critical Client Flow</div>
    <button class="btn" id="back">← Back</button>
  </header>

  <div class="canvas" id="canvas">
    <svg id="svg" viewBox="0 0 4000 1600">
      <defs>
        <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="14" markerHeight="14" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"></path>
        </marker>
        <linearGradient id="grad0" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#2563eb"/>
          <stop offset="100%" stop-color="#1e40af"/>
        </linearGradient>
        <linearGradient id="grad1" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#0891b2"/>
          <stop offset="100%" stop-color="#155e75"/>
        </linearGradient>
        <linearGradient id="grad2" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#10b981"/>
          <stop offset="100%" stop-color="#065f46"/>
        </linearGradient>
        <linearGradient id="grad3" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#f59e0b"/>
          <stop offset="100%" stop-color="#92400e"/>
        </linearGradient>
        <linearGradient id="grad4" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#ec4899"/>
          <stop offset="100%" stop-color="#9d174d"/>
        </linearGradient>
        <linearGradient id="grad5" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#8b5cf6"/>
          <stop offset="100%" stop-color="#4c1d95"/>
        </linearGradient>
        <linearGradient id="grad6" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#ef4444"/>
          <stop offset="100%" stop-color="#7f1d1d"/>
        </linearGradient>
      </defs>
      <g id="edges"></g>
      <g id="nodes"></g>
    </svg>
  </div>

  <script>
    const milestones=[
      { id:'enquiry', title:'Enquiry received & logged', substeps:[
        {id:'enq1', title:'Capture via web, email or phone'},
        {id:'enq2', title:'Log in CRM/Opsync'},
        {id:'enq3', title:'Auto-acknowledge receipt'}
      ]},
      { id:'qualify', title:'Qualification', substeps:[
        {id:'q1', title:'Clarify scope, budget, dates, venue'},
        {id:'q2', title:'Tiering (T1/T2/T3)'},
        {id:'q3', title:'Assign provisional owner'}
      ]},
      { id:'proposal', title:'Proposal / Quote sent', substeps:[
        {id:'p1', title:'Estimate crew, kit, logistics'},
        {id:'p2', title:'Price build + GP check'},
        {id:'p3', title:'Proposal issued with expiry'}
      ]},
      { id:'approval', title:'Approval & Deposit', substeps:[
        {id:'a1', title:'Contract + T&Cs issued'},
        {id:'a2', title:'PO or e-signature captured'},
        {id:'a3', title:'Deposit/payment confirmed'}
      ]},
      { id:'planning', title:'Pre-production & Planning', substeps:[
        { id:'assignPM', title:'Assign PM & create plan' },
        { id:'designSignoff', title:'Design sign-off & HOD review' },
        { id:'crewLogistics', title:'Crew, logistics, kit prep scheduled' }
      ]},
      { id:'delivery', title:'Event Delivery', substeps:[
        {id:'d1', title:'Warehouse prep & QA checks'},
        {id:'d2', title:'Load-in → show → load-out'},
        {id:'d3', title:'On-site sign-offs captured'}
      ]},
      { id:'wrap', title:'Post-event wrap → END', substeps:[
        {id:'w1', title:'Crew & client feedback captured'},
        {id:'w2', title:'Final invoice issued and paid'},
        {id:'w3', title:'Retrospective stored'}
      ]}
    ];

    const svg=document.getElementById('svg');
    const gNodes=document.getElementById('nodes');
    const gEdges=document.getElementById('edges');
    const backBtn=document.getElementById('back');

    function wrapText(text, maxChars){
      const words=text.split(' ');
      let line='';
      const lines=[];
      words.forEach(w=>{
        if((line+w).length>maxChars){lines.push(line.trim());line=w+' ';}
        else line+=w+' ';
      });
      lines.push(line.trim());
      return lines;
    }

    function clear(){gNodes.innerHTML='';gEdges.innerHTML='';}

    function drawFlow(items,vertical=false){
      clear();
      const NODE_W=700,NODE_H=300,SPACING=300;
      items.forEach((s,i)=>{
        const x=100+i*(NODE_W+SPACING);
        const y=500;
        const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('data-id',s.id);
        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x',x);
        rect.setAttribute('y',y);
        rect.setAttribute('width',NODE_W);
        rect.setAttribute('height',NODE_H);
        rect.setAttribute('class','node');
        rect.setAttribute('fill',`url(#grad${i%7})`);

        const label=document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x',x+NODE_W/2);
        label.setAttribute('y',y+NODE_H/2-40);
        label.setAttribute('class','label');

        const lines=wrapText(s.title,20);
        lines.forEach((line,idx)=>{
          const tspan=document.createElementNS('http://www.w3.org/2000/svg','tspan');
          tspan.setAttribute('x',x+NODE_W/2);
          tspan.setAttribute('dy',idx===0?0:56);
          tspan.textContent=line;
          label.appendChild(tspan);
        });

        g.appendChild(rect);g.appendChild(label);
        gNodes.appendChild(g);
        if(i<items.length-1){
          const path=document.createElementNS('http://www.w3.org/2000/svg','path');
          path.setAttribute('d',`M ${x+NODE_W} ${y+NODE_H/2} L ${x+NODE_W+SPACING} ${y+NODE_H/2}`);
          path.setAttribute('class','edge');
          gEdges.appendChild(path);
        }
      });
    }

    let currentLevel='overview';
    function showOverview(){
      currentLevel='overview';
      backBtn.style.display='none';
      drawFlow(milestones,false);
    }
    function showSubsteps(id){
      const m=milestones.find(x=>x.id===id);
      if(!m||!m.substeps) return;
      currentLevel=id;
      backBtn.style.display='inline-block';
      clear();
      const NODE_W=700,NODE_H=220,SPACING=200;
      m.substeps.forEach((s,i)=>{
        const x=1500;
        const y=100+i*(NODE_H+SPACING);
        const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('data-id',s.id);
        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x',x);
        rect.setAttribute('y',y);
        rect.setAttribute('width',NODE_W);
        rect.setAttribute('height',NODE_H);
        rect.setAttribute('class','node');
        rect.setAttribute('fill','url(#grad0)');

        const label=document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x',x+NODE_W/2);
        label.setAttribute('y',y+NODE_H/2-20);
        label.setAttribute('class','label');

        const lines=wrapText(s.title,22);
        lines.forEach((line,idx)=>{
          const tspan=document.createElementNS('http://www.w3.org/2000/svg','tspan');
          tspan.setAttribute('x',x+NODE_W/2);
          tspan.setAttribute('dy',idx===0?0:50);
          tspan.textContent=line;
          label.appendChild(tspan);
        });

        g.appendChild(rect);g.appendChild(label);
        gNodes.appendChild(g);
        if(i<m.substeps.length-1){
          const path=document.createElementNS('http://www.w3.org/2000/svg','path');
          path.setAttribute('d',`M ${x+NODE_W/2} ${y+NODE_H} L ${x+NODE_W/2} ${y+NODE_H+SPACING}`);
          path.setAttribute('class','edge');
          gEdges.appendChild(path);
        }
      });
    }

    gNodes.addEventListener('click',e=>{
      const g=e.target.closest('g[data-id]');
      if(!g) return;
      const id=g.getAttribute('data-id');
      if(currentLevel==='overview') showSubsteps(id);
    });

    backBtn.addEventListener('click',showOverview);

    // Pan & zoom
    let view={x:0,y:0,w:4000,h:1600};
    function applyView(){svg.setAttribute('viewBox',`${view.x} ${view.y} ${view.w} ${view.h}`)}
    applyView();
    const canvasEl=document.getElementById('canvas');
    let isPanning=false,start={x:0,y:0},startView={...view};
    canvasEl.addEventListener('pointerdown',e=>{isPanning=true;canvasEl.setPointerCapture(e.pointerId);start={x:e.clientX,y:e.clientY};startView={...view};});
    canvasEl.addEventListener('pointermove',e=>{if(!isPanning)return;const rect=svg.getBoundingClientRect();const dx=(e.clientX-start.x)*(view.w/rect.width);const dy=(e.clientY-start.y)*(view.h/rect.height);view.x=startView.x-dx;view.y=startView.y-dy;applyView();});
    canvasEl.addEventListener('pointerup',()=>{isPanning=false});
    canvasEl.addEventListener('pointercancel',()=>{isPanning=false});
    canvasEl.addEventListener('wheel',e=>{e.preventDefault();const scale=(e.deltaY<0)?0.9:1.1;const rect=svg.getBoundingClientRect();const mx=(e.clientX-rect.left)/rect.width;const my=(e.clientY-rect.top)/rect.height;const vx=view.x+view.w*mx;const vy=view.y+view.h*my;view.w*=scale;view.h*=scale;view.x=vx-view.w*mx;view.y=vy-view.h*my;applyView();},{passive:false});

    showOverview();
  </script>
</body>
</html>
