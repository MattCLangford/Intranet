<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wise Productions — CCF Drill-down</title>
  <style>
    body{margin:0;background:#0b0f14;color:#e5ecf4;font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans';}
    header{background:#111827;padding:.8rem 1rem;display:flex;align-items:center;gap:1rem;}
    .title{font-weight:700}
    .btn{appearance:none;border:1px solid #374151;background:#1f2937;color:#e5ecf4;padding:.45rem .8rem;border-radius:8px;cursor:pointer;}
    .wrap{display:grid;grid-template-columns:1fr 300px;gap:1rem;padding:1rem;}
    .panel{background:#111827;border:1px solid #374151;border-radius:12px;overflow:hidden}
    #stageDetails{padding:1rem}
    h2{margin:.2rem 0 .6rem;font-size:1.2rem}
    .list{margin:.5rem 0 0 1.1rem}
    .canvas{position:relative;height:72vh;min-height:420px}
    svg{width:100%;height:100%;display:block;}
    .node{fill:url(#gradNode);stroke:#2563eb;stroke-width:2;rx:14;ry:14;cursor:pointer;filter:drop-shadow(0 4px 6px rgba(0,0,0,.5));}
    .label{font-size:16px;fill:#ffffff;font-weight:700;pointer-events:none;}
    .edge{stroke:#64748b;stroke-width:2.5;fill:none;marker-end:url(#arrow)}
  </style>
</head>
<body>
  <header>
    <div class="title">Wise Productions — CCF Drill-down</div>
    <button class="btn" id="back" style="display:none">← Back</button>
  </header>

  <main class="wrap">
    <section class="panel">
      <div class="canvas" id="canvas">
        <svg id="svg" viewBox="0 0 1600 800">
          <defs>
            <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
              <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748b"></path>
            </marker>
            <linearGradient id="gradNode" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#2563eb"/>
              <stop offset="100%" stop-color="#0891b2"/>
            </linearGradient>
          </defs>
          <g id="edges"></g>
          <g id="nodes"></g>
        </svg>
      </div>
    </section>
    <aside class="panel" id="stageDetails">
      <h2 id="detailTitle">Overview</h2>
      <ul class="list" id="bulletList"></ul>
    </aside>
  </main>

  <script>
    const milestones = [
      { id:'enquiry', title:'Enquiry received & logged' },
      { id:'qualify', title:'Qualification' },
      { id:'proposal', title:'Proposal / Quote sent' },
      { id:'approval', title:'Approval & Deposit' },
      { id:'planning', title:'Pre-production & Planning', substeps:[
        { id:'assignPM', title:'Assign PM & create plan' },
        { id:'designSignoff', title:'Design sign-off & HOD review' },
        { id:'crewLogistics', title:'Crew, logistics, kit prep scheduled' }
      ] },
      { id:'delivery', title:'Event Delivery' },
      { id:'wrap', title:'Post-event wrap → END' }
    ];

    const svg=document.getElementById('svg');
    const gNodes=document.getElementById('nodes');
    const gEdges=document.getElementById('edges');
    const detailTitle=document.getElementById('detailTitle');
    const list=document.getElementById('bulletList');
    const backBtn=document.getElementById('back');

    let view={x:0,y:0,w:1600,h:800};
    function applyView(){svg.setAttribute('viewBox',`${view.x} ${view.y} ${view.w} ${view.h}`)}
    applyView();

    function clear(){ gNodes.innerHTML=''; gEdges.innerHTML=''; }

    function drawFlow(items, vertical=false){
      clear();
      const NODE_W=260, NODE_H=90, SPACING=120;
      items.forEach((s,i)=>{
        const x=vertical?600:60+i*(NODE_W+SPACING);
        const y=vertical?60+i*(NODE_H+SPACING):250;
        const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('data-id',s.id);
        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x',x);
        rect.setAttribute('y',y);
        rect.setAttribute('width',NODE_W);
        rect.setAttribute('height',NODE_H);
        rect.setAttribute('class','node');
        const label=document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x',x+20);
        label.setAttribute('y',y+NODE_H/2+6);
        label.setAttribute('class','label');
        label.textContent=s.title;
        g.appendChild(rect); g.appendChild(label);
        gNodes.appendChild(g);
        if(i<items.length-1){
          const path=document.createElementNS('http://www.w3.org/2000/svg','path');
          if(vertical){
            path.setAttribute('d',`M ${x+NODE_W/2} ${y+NODE_H} L ${x+NODE_W/2} ${y+NODE_H+SPACING}`);
          }else{
            path.setAttribute('d',`M ${x+NODE_W} ${y+NODE_H/2} L ${x+NODE_W+SPACING} ${y+NODE_H/2}`);
          }
          path.setAttribute('class','edge');
          gEdges.appendChild(path);
        }
      });
    }

    let currentLevel='overview';
    function showOverview(){
      currentLevel='overview';
      backBtn.style.display='none';
      detailTitle.textContent='Overview';
      list.innerHTML='<li>Click a milestone to drill into its steps</li>';
      drawFlow(milestones,false);
    }
    function showSubsteps(id){
      const m=milestones.find(x=>x.id===id);
      if(!m||!m.substeps) return;
      currentLevel=id;
      backBtn.style.display='inline-block';
      detailTitle.textContent=m.title;
      list.innerHTML=m.substeps.map(s=>`<li>${s.title}</li>`).join('');
      drawFlow(m.substeps,true);
    }

    gNodes.addEventListener('click', e=>{
      const g=e.target.closest('g[data-id]');
      if(!g) return;
      const id=g.getAttribute('data-id');
      if(currentLevel==='overview') showSubsteps(id);
    });

    backBtn.addEventListener('click',showOverview);

    // Pan & zoom
    const canvasEl=document.getElementById('canvas');
    let isPanning=false,start={x:0,y:0},startView={...view};
    canvasEl.addEventListener('pointerdown',e=>{isPanning=true;canvasEl.setPointerCapture(e.pointerId);start={x:e.clientX,y:e.clientY};startView={...view};});
    canvasEl.addEventListener('pointermove',e=>{if(!isPanning)return;const rect=svg.getBoundingClientRect();const dx=(e.clientX-start.x)*(view.w/rect.width);const dy=(e.clientY-start.y)*(view.h/rect.height);view.x=startView.x-dx;view.y=startView.y-dy;applyView();});
    canvasEl.addEventListener('pointerup',()=>{isPanning=false});
    canvasEl.addEventListener('pointercancel',()=>{isPanning=false});
    canvasEl.addEventListener('wheel',e=>{e.preventDefault();const scale=(e.deltaY<0)?0.9:1.1;const rect=svg.getBoundingClientRect();const mx=(e.clientX-rect.left)/rect.width;const my=(e.clientY-rect.top)/rect.height;const vx=view.x+view.w*mx;const vy=view.y+view.h*my;view.w*=scale;view.h*=scale;view.x=vx-view.w*mx;view.y=vy-view.h*my;applyView();},{passive:false});

    showOverview();
  </script>
</body>
</html>
