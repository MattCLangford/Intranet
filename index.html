<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wise Productions — Critical Client Flow</title>
  <style>
    body {
      margin: 0;
      background: #0b0f14;
      color: #fff;
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
      overflow: hidden;
    }
    header {
      background: #111827;
      padding: .8rem 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .title {
      font-weight: 700;
      font-size: 1.4rem;
    }
    .btn {
      appearance: none;
      border: none;
      background: #2563eb;
      color: #fff;
      padding: .55rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      display: none;
    }
    .canvas {
      position: relative;
      height: 90vh;
    }
    svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    .node rect {
      stroke: #0f172a;
      stroke-width: 3;
      rx: 32;
      ry: 32;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,.6));
      transition: all 0.3s ease-in-out;
    }
    .label {
      font-size: 42px;
      fill: #ffffff;
      font-weight: 800;
      pointer-events: none;
      text-anchor: middle;
      dominant-baseline: hanging;
      transition: all 0.3s ease-in-out;
    }
    .subtext {
      font-size: 22px;
      fill: #e5e7eb;
      font-weight: 400;
      pointer-events: none;
      text-anchor: middle;
      dominant-baseline: hanging;
    }
    .edge {
      stroke: #94a3b8;
      stroke-width: 6;
      fill: none;
      marker-end: url(#arrow);
      transition: all 0.3s ease-in-out;
    }
    .dimmed rect {
      filter: grayscale(100%) brightness(0.5);
      transform: scale(0.95);
    }
    .dimmed text {
      fill: #6b7280 !important;
    }
    .dimmed-edge {
      stroke: #1f2937 !important;
    }
    .highlight rect {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <header>
    <div class="title">Wise Productions — Critical Client Flow</div>
    <button class="btn" id="back">← Back</button>
  </header>

  <div class="canvas" id="canvas">
    <svg id="svg" viewBox="0 0 2000 4000">
      <defs>
        <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="14" markerHeight="14" orient="auto-start-reverse">
          <path d="M 0 0 L 10 5 L 0 10 z" fill="#94a3b8"></path>
        </marker>
        <linearGradient id="grad0" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#2563eb"/>
          <stop offset="100%" stop-color="#1e40af"/>
        </linearGradient>
        <linearGradient id="grad1" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#0891b2"/>
          <stop offset="100%" stop-color="#155e75"/>
        </linearGradient>
        <linearGradient id="grad2" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#10b981"/>
          <stop offset="100%" stop-color="#065f46"/>
        </linearGradient>
        <linearGradient id="grad3" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#f59e0b"/>
          <stop offset="100%" stop-color="#92400e"/>
        </linearGradient>
        <linearGradient id="grad4" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#ec4899"/>
          <stop offset="100%" stop-color="#9d174d"/>
        </linearGradient>
        <linearGradient id="grad5" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#8b5cf6"/>
          <stop offset="100%" stop-color="#4c1d95"/>
        </linearGradient>
        <linearGradient id="grad6" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#ef4444"/>
          <stop offset="100%" stop-color="#7f1d1d"/>
        </linearGradient>
      </defs>
      <g id="edges"></g>
      <g id="nodes"></g>
    </svg>
  </div>

  <script>
    const milestones = [
      { id:'enquiry', title:'Enquiry received & logged', substeps:[
        'Capture via web, email or phone',
        'Log in CRM/Opsync',
        'Auto-acknowledge receipt'
      ]},
      { id:'qualify', title:'Qualification', substeps:[
        'Clarify scope, budget, dates, venue',
        'Tiering (T1/T2/T3)',
        'Assign provisional owner'
      ]},
      { id:'proposal', title:'Proposal / Quote sent', substeps:[
        'Estimate crew, kit, logistics',
        'Price build + GP check',
        'Proposal issued with expiry'
      ]},
      { id:'approval', title:'Approval & Deposit', substeps:[
        'Contract + T&Cs issued',
        'PO or e-signature captured',
        'Deposit/payment confirmed'
      ]},
      { id:'planning', title:'Pre-production & Planning', substeps:[
        'Assign PM & create plan',
        'Design sign-off & HOD review',
        'Crew, logistics, kit prep scheduled'
      ]},
      { id:'delivery', title:'Event Delivery', substeps:[
        'Warehouse prep & QA checks',
        'Load-in → show → load-out',
        'On-site sign-offs captured'
      ]},
      { id:'wrap', title:'Post-event wrap → END', substeps:[
        'Crew & client feedback captured',
        'Final invoice issued and paid',
        'Retrospective stored'
      ]}
    ];

    const svg=document.getElementById('svg');
    const gNodes=document.getElementById('nodes');
    const gEdges=document.getElementById('edges');
    const backBtn=document.getElementById('back');

    function clear(){gNodes.innerHTML='';gEdges.innerHTML='';}

    function drawFlow(items){
      clear();
      const NODE_W=800, SPACING=200;
      const centerX = 1000 - NODE_W/2;
      let y = 200;
      items.forEach((s,i)=>{
        const lineCount=s.substeps.length+1;
        const NODE_H=140+(lineCount*40);

        const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('data-id',s.id);
        g.setAttribute('class','node');

        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x',centerX);
        rect.setAttribute('y',y);
        rect.setAttribute('width',NODE_W);
        rect.setAttribute('height',NODE_H);
        rect.setAttribute('fill',`url(#grad${i%7})`);

        const label=document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x',centerX+NODE_W/2);
        label.setAttribute('y',y+50);
        label.setAttribute('class','label');
        label.textContent=s.title;

        g.appendChild(rect);
        g.appendChild(label);

        s.substeps.forEach((st,idx)=>{
          const sub=document.createElementNS('http://www.w3.org/2000/svg','text');
          sub.setAttribute('x',centerX+NODE_W/2);
          sub.setAttribute('y',y+110+(idx*36));
          sub.setAttribute('class','subtext');
          sub.textContent='• '+st;
          g.appendChild(sub);
        });

        gNodes.appendChild(g);

        if(i<items.length-1){
          const path=document.createElementNS('http://www.w3.org/2000/svg','path');
          path.setAttribute('d',`M ${centerX+NODE_W/2} ${y+NODE_H} L ${centerX+NODE_W/2} ${y+NODE_H+SPACING}`);
          path.setAttribute('class','edge');
          gEdges.appendChild(path);
        }

        y += NODE_H + SPACING;
      });
    }

    let currentLevel='overview';
    function showOverview(){
      currentLevel='overview';
      backBtn.style.display='none';
      drawFlow(milestones);
      resetView();
    }

    function showSubsteps(id){
      const m=milestones.find(x=>x.id===id);
      if(!m) return;
      currentLevel=id;
      backBtn.style.display='inline-block';
      clear();
      const NODE_W=800,NODE_H=220,SPACING=150;
      const centerX=1000-NODE_W/2;
      let y=200;
      m.substeps.forEach((s,i)=>{
        const g=document.createElementNS('http://www.w3.org/2000/svg','g');
        g.setAttribute('data-id',s);
        g.setAttribute('class','node');

        const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');
        rect.setAttribute('x',centerX);
        rect.setAttribute('y',y);
        rect.setAttribute('width',NODE_W);
        rect.setAttribute('height',NODE_H);
        rect.setAttribute('fill','url(#grad0)');

        const label=document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x',centerX+NODE_W/2);
        label.setAttribute('y',y+NODE_H/2);
        label.setAttribute('class','label');
        label.textContent=s;

        g.appendChild(rect);
        g.appendChild(label);
        gNodes.appendChild(g);

        if(i<m.substeps.length-1){
          const path=document.createElementNS('http://www.w3.org/2000/svg','path');
          path.setAttribute('d',`M ${centerX+NODE_W/2} ${y+NODE_H} L ${centerX+NODE_W/2} ${y+NODE_H+SPACING}`);
          path.setAttribute('class','edge');
          gEdges.appendChild(path);
        }
        y+=NODE_H+SPACING;
      });
      resetView();
    }

    // Hover spotlight
    gNodes.addEventListener('mouseover',e=>{
      const g=e.target.closest('g[data-id]');
      if(!g) return;
      gNodes.querySelectorAll('g').forEach(node=>{
        if(node===g){
          node.classList.add('highlight');
          node.classList.remove('dimmed');
        } else {
          node.classList.add('dimmed');
          node.classList.remove('highlight');
        }
      });
      gEdges.querySelectorAll('path').forEach(edge=>edge.classList.add('dimmed-edge'));
    });

    gNodes.addEventListener('mouseout',()=>{
      gNodes.querySelectorAll('g').forEach(node=>node.classList.remove('dimmed','highlight'));
      gEdges.querySelectorAll('path').forEach(e=>e.classList.remove('dimmed-edge'));
    });

    // Click
    gNodes.addEventListener('click',e=>{
      const g=e.target.closest('g[data-id]');
      if(!g) return;
      const id=g.getAttribute('data-id');
      if(currentLevel==='overview') showSubsteps(id);
    });

    backBtn.addEventListener('click',showOverview);

    // Pan & zoom with separate input handling
    let view={x:0,y:0,w:2000,h:4000};
    function applyView(){svg.setAttribute('viewBox',`${view.x} ${view.y} ${view.w} ${view.h}`)}
    function resetView(){view={x:0,y:0,w:2000,h:4000};applyView();}
    applyView();

    const canvasEl=document.getElementById('canvas');
    let isPanning=false,start={x:0,y:0},startView={...view},panMode=null;

    canvasEl.addEventListener('pointerdown',e=>{
      // mouse right/middle -> pan
      if(e.pointerType==='mouse' && (e.button===1 || e.button===2)){
        panMode='mouse';
        isPanning=true;
        start={x:e.clientX,y:e.clientY};
        startView={...view};
        canvasEl.setPointerCapture(e.pointerId);
      }
      // touch with 2 fingers -> pan
      if(e.pointerType==='touch'){
        if(e.isPrimary) return;
        panMode='touch';
        isPanning=true;
        start={x:e.clientX,y:e.clientY};
        startView={...view};
        canvasEl.setPointerCapture(e.pointerId);
      }
    });

    canvasEl.addEventListener('pointermove',e=>{
      if(!isPanning) return;
      const rect=svg.getBoundingClientRect();
      const dx=(e.clientX-start.x)*(view.w/rect.width);
      const dy=(e.clientY-start.y)*(view.h/rect.height);
      view.x=startView.x-dx;
      view.y=startView.y-dy;
      applyView();
    });

    canvasEl.addEventListener('pointerup',()=>{isPanning=false;panMode=null;});
    canvasEl.addEventListener('pointercancel',()=>{isPanning=false;panMode=null;});

    canvasEl.addEventListener('wheel',e=>{
      e.preventDefault();
      const scale=(e.deltaY<0)?0.9:1.1;
      const rect=svg.getBoundingClientRect();
      const mx=(e.clientX-rect.left)/rect.width;
      const my=(e.clientY-rect.top)/rect.height;
      const vx=view.x+view.w*mx;
      const vy=view.y+view.h*my;
      view.w*=scale;
      view.h*=scale;
      view.x=vx-view.w*mx;
      view.y=vy-view.h*my;
      applyView();
    },{passive:false});

    showOverview();
  </script>
</body>
</html>
